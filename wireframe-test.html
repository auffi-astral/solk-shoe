<!DOCTYPE html>
<html>
<head>
    <title>Wireframe Test</title>
    <style>
        body { margin: 0; background: black; overflow-x: hidden; }
        #container { position: fixed; width: 100vw; height: 100vh; }
        #info { position: absolute; top: 20px; left: 20px; color: white; z-index: 100; }
        #content { height: 300vh; }
        #debug { position: absolute; top: 100px; left: 20px; color: red; z-index: 100; font-size: 20px; }
        #controls { position: absolute; top: 150px; left: 20px; color: white; z-index: 100; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="info">
        <h2>Clean Wireframe Test</h2>
        <p>Direct wireframe with hover highlighting</p>
    </div>
    <div id="debug">Starting...</div>
    <div id="controls">
        <h3>Wireframe Settings</h3>
        <label>Base Opacity: <span id="baseOpacityValue">0.7</span></label><br>
        <input type="range" id="baseOpacity" min="0.1" max="1.0" step="0.1" value="0.7"><br><br>
        
        <label>Line Width: <span id="lineWidthValue">1.0</span></label><br>
        <input type="range" id="lineWidth" min="0.5" max="3.0" step="0.1" value="1.0"><br><br>
        
        <button onclick="resetDefaults()">Reset</button>
    </div>
    <div id="content"></div>

    <script src="three.min.js"></script>
    <script src="GLTFLoader.js"></script>
    <script src="OrbitControls.js"></script>
    <script>
        var scene, camera, renderer, model, controls, scrollY = 0;
        var raycaster, mouse = new THREE.Vector2();
        var modelChildren = [];
        var hoveredMesh = null;
        
        document.getElementById('debug').innerHTML = 'Setting up Three.js...';
        
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 10);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('container').appendChild(renderer.domElement);
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        
        var light = new THREE.AmbientLight(0xffffff, 1);
        scene.add(light);
        
        raycaster = new THREE.Raycaster();
        
        // Create clean wireframe material
        function createCleanWireframeMaterial(color, opacity) {
            return new THREE.MeshBasicMaterial({
                color: color,
                wireframe: true,
                transparent: true,
                opacity: opacity,
                depthTest: true,
                depthWrite: false
            });
        }
        
        // Setup UI controls
        function setupControls() {
            const baseOpacitySlider = document.getElementById('baseOpacity');
            const lineWidthSlider = document.getElementById('lineWidth');
            
            const baseOpacityValue = document.getElementById('baseOpacityValue');
            const lineWidthValue = document.getElementById('lineWidthValue');
            
            baseOpacitySlider.addEventListener('input', function() {
                const value = parseFloat(this.value);
                baseOpacityValue.textContent = value.toFixed(1);
                updateMaterials();
            });
            
            lineWidthSlider.addEventListener('input', function() {
                const value = parseFloat(this.value);
                lineWidthValue.textContent = value.toFixed(1);
                renderer.setPixelRatio(value);
            });
        }
        
        function updateMaterials() {
            const baseOpacity = parseFloat(document.getElementById('baseOpacity').value);
            
            modelChildren.forEach(function(mesh) {
                if (mesh !== hoveredMesh) {
                    mesh.material = createCleanWireframeMaterial(0xffffff, baseOpacity);
                }
            });
        }
        
        window.resetDefaults = function() {
            document.getElementById('baseOpacity').value = 0.7;
            document.getElementById('lineWidth').value = 1.0;
            document.getElementById('baseOpacityValue').textContent = '0.7';
            document.getElementById('lineWidthValue').textContent = '1.0';
            updateMaterials();
            renderer.setPixelRatio(1.0);
        };
        
        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(modelChildren);
            
            // Reset previous hover
            if (hoveredMesh) {
                const baseOpacity = parseFloat(document.getElementById('baseOpacity').value);
                hoveredMesh.material = createCleanWireframeMaterial(0xffffff, baseOpacity);
            }
            
            if (intersects.length > 0) {
                hoveredMesh = intersects[0].object;
                // Highlight hovered mesh in bright white, full opacity
                hoveredMesh.material = createCleanWireframeMaterial(0xffffff, 1.0);
                document.getElementById('debug').innerHTML = 'Hovering: ' + (hoveredMesh.name || 'mesh part');
            } else {
                hoveredMesh = null;
                document.getElementById('debug').innerHTML = 'Move mouse over shoe parts';
            }
        }
        
        document.getElementById('debug').innerHTML = 'Loading shoe...';
        
        var loader = new THREE.GLTFLoader();
        loader.load('shoe-nodraco.glb', 
            function(gltf) {
                document.getElementById('debug').innerHTML = 'SHOE LOADED!';
                model = gltf.scene;
                
                model.traverse(function(child) {
                    if (child.isMesh) {
                        modelChildren.push(child);
                        
                        // Use clean wireframe material - shows ALL triangles
                        child.material = createCleanWireframeMaterial(0xffffff, 0.7);
                    }
                });
                
                var box = new THREE.Box3().setFromObject(model);
                var size = box.getSize(new THREE.Vector3());
                var maxSize = Math.max(size.x, size.y, size.z);
                var scale = 50 / maxSize;
                model.position.set(0, 0, 0);
                model.scale.setScalar(scale);
                scene.add(model);
                
                window.addEventListener('mousemove', onMouseMove);
                setupControls();
                document.getElementById('debug').innerHTML = 'All wireframe details visible!';
            },
            function(progress) {
                console.log('Loading:', (progress.loaded/progress.total*100) + '%');
            },
            function(error) {
                document.getElementById('debug').innerHTML = 'FAILED: ' + error.message;
                console.error('Error:', error);
            }
        );
        
        window.addEventListener('scroll', function() { scrollY = window.pageYOffset; });
        
        function animate() {
            requestAnimationFrame(animate);
            if (model) {
                var rot = scrollY * 0.005;
                model.rotation.y = rot;
                model.rotation.x = rot * 0.3;
            }
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>